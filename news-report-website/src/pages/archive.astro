---
import Layout from '../layouts/Layout.astro';

const reportModules = import.meta.glob('../../../NewsReport/*.md');
const reportEntries = await Promise.all(
  Object.entries(reportModules).map(async ([path, loader]) => ({
    path,
    report: await loader(),
  }))
);
const basePath = import.meta.env.BASE_URL ?? '/';
const base = basePath.endsWith('/') ? basePath.slice(0, -1) : basePath;
const getDateFromFile = (filePath) => {
  const fileName = filePath.split('/').pop() || '';
  return fileName.replace('-news-report.md', '').replace('.md', '');
};

const sortedReports = reportEntries
  .map(({ path, report }) => ({ report, date: getDateFromFile(path) }))
  .sort((a, b) => (a.date < b.date ? 1 : -1));
---

<Layout title="Archive - Daily News Report">
  <main class="max-w-5xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-white mb-6">ðŸ“š Archive</h1>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {sortedReports.map(({ date }) => (
        <a class="bg-gray-900 rounded-lg p-4 border border-gray-800 hover:border-gray-700 transition-colors" href={`${base}/${date}`}>
          <div class="text-white font-medium">{date}</div>
        </a>
      ))}
    </div>
  </main>
</Layout>
