---
import Layout from '../layouts/Layout.astro';

const reportModules = import.meta.glob('../../../NewsReport/*.md');
const reportEntries = await Promise.all(
  Object.entries(reportModules).map(async ([path, loader]) => ({
    path,
    report: await loader(),
  }))
);
const basePath = import.meta.env.BASE_URL ?? '/';
const base = basePath.endsWith('/') ? basePath.slice(0, -1) : basePath;
const getDateFromFile = (filePath) => {
  const fileName = filePath.split('/').pop() || '';
  return fileName.replace('-news-report.md', '').replace('.md', '');
};

const sortedReports = reportEntries
  .map(({ path, report }) => ({ report, date: getDateFromFile(path) }))
  .sort((a, b) => (a.date < b.date ? 1 : -1));

const latest = sortedReports[0];
const LatestContent = latest ? latest.report.default : null;
---

<Layout title="Daily News Report">
  <main class="max-w-5xl mx-auto px-4 py-8">
    <div class="mb-10">
      <h1 class="text-3xl font-bold text-white mb-2">ğŸ“° Daily News Report</h1>
      <p class="text-gray-400">æœ€æ–°æ—¥æŠ¥å†…å®¹ä¸å†å²å½’æ¡£</p>
    </div>

    {latest ? (
      <section class="mb-12">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-2xl font-semibold text-white">æœ€æ–°æ—¥æŠ¥: {latest.date}</h2>
          <a class="text-blue-400" href={`${base}/${latest.date}`}>æŸ¥çœ‹è¯¦æƒ… â†’</a>
        </div>
        <div class="report-content bg-gray-900 rounded-xl p-6 border border-gray-800">
          {LatestContent ? <LatestContent /> : <p class="text-gray-400">æš‚æ— å†…å®¹</p>}
        </div>
      </section>
    ) : (
      <div class="text-gray-400">æœªæ‰¾åˆ°ä»»ä½•æ—¥æŠ¥æ–‡ä»¶</div>
    )}

    <section>
      <h2 class="text-2xl font-semibold text-white mb-4">å†å²æ—¥æŠ¥</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {sortedReports.map(({ date }) => (
          <a class="bg-gray-900 rounded-lg p-4 border border-gray-800 hover:border-gray-700 transition-colors" href={`${base}/${date}`}>
            <div class="text-white font-medium">{date}</div>
          </a>
        ))}
      </div>
    </section>
  </main>
</Layout>
